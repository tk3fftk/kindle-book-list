# 📚 Kindle ブックコレクター

[English](README.md) | **日本語**

Amazon Kindleライブラリから本のタイトルと著者を自動収集・エクスポートする強力なブラウザベースJavaScriptツールです。複数ページ対応とCSVエクスポート機能を備えています。

## ✨ 機能

- **📖 スマートブック収集**: Kindleライブラリページから本のタイトルと著者を自動抽出
- **🤖 複数ページ自動化**: ライブラリの全ページをシームレスに巡回
- **🔗 続編シリーズの自動結合**: 続編を自動で結合（例：`Volume(1)`, `Volume(2)` → `Volume(1-2)`）
- **🌏 全角文字サポート**: ASCII文字と全角数字・括弧の両方に対応
- **💾 複数エクスポートオプション**: オリジナルと結合済みデータ両方のCSVファイルダウンロードとクリップボードコピー
- **🔄 リアルタイム進捗**: 収集状況と進捗のライブコンソールフィードバック
- **🎯 堅牢なセレクター**: 現在のKindleライブラリインターフェースで動作する信頼性の高いDOMセレクター
- **⚡ ブラウザコンソールインターフェース**: 簡単操作のためのシンプルなコマンド

## 🚀 クイックスタート

### 前提条件

- モダンなウェブブラウザ（Chrome、Firefox、Safari、Edge）
- Amazon Kindleライブラリへのアクセス

### セットアップと使用方法

1. **Kindleライブラリに移動**:
   ```
   https://read.amazon.com/kindle-library
   ```

2. **ブラウザの開発者コンソールを開く**:
   - **Chrome/Edge**: `F12`キーまたは`Ctrl+Shift+I`（Windows）/`Cmd+Option+I`（Mac）
   - **Firefox**: `F12`キーまたは`Ctrl+Shift+K`（Windows）/`Cmd+Option+K`（Mac）
   - **Safari**: `Cmd+Option+I`（最初に開発者メニューを有効にする必要があります）

3. **スクリプトをコピー&ペースト**:
   `kindle_collect.js`の全内容をコピーしてコンソールに貼り付け、Enterキーを押します。

4. **収集開始**:
   ```javascript
   // 全ページの自動収集
   collectAllPages()
   
   // 続編結合付きで全ページを自動収集
   collectAllPages({mergeSequels: true})
   
   // またはページごとの手動収集
   collectBooks()  // 現在のページを収集
   nextPage()      // 次のページに移動
   ```

## 📋 利用可能なコマンド

### 収集コマンド

| コマンド | 説明 |
|---------|------|
| `collectBooks()` | 現在のページから本を収集 |
| `collectAllPages()` | 全ページから自動収集 |
| `collectAllPages({mergeSequels: true})` | 全ページ自動収集と続編結合 |
| `showResults()` | 収集結果のサマリーを表示 |

### ナビゲーションコマンド

| コマンド | 説明 |
|---------|------|
| `nextPage()` | 次のページに手動移動 |

### 続編結合コマンド

| コマンド | 説明 |
|---------|------|
| `mergeSequels()` | 続編シリーズを巻数範囲に結合 |
| `showMerged()` | 結合済みコレクションのサマリーを表示 |

### エクスポートコマンド

| コマンド | 説明 |
|---------|------|
| `downloadCSV()` | オリジナル収集データをCSVファイルとしてダウンロード |
| `downloadMergedCSV()` | 結合済みコレクションをCSVファイルとしてダウンロード |
| `copyCSV()` | オリジナルCSVデータをクリップボードにコピー |
| `copyMergedCSV()` | 結合済みCSVデータをクリップボードにコピー |
| `toCSV()` | オリジナルCSVデータを文字列として取得 |
| `toMergedCSV()` | 結合済みCSVデータを文字列として取得 |

### ユーティリティコマンド

| コマンド | 説明 |
|---------|------|
| `help()` | 利用可能な全コマンドを表示 |
| `initializeKindleCollector()` | 必要に応じてコレクターを再初期化 |

## 💾 エクスポートオプション

### CSVフォーマット

エクスポートされるデータには以下が含まれます：

- **タイトル**: 本のタイトル（CSV互換性のためカンマを全角カンマに置換）
- **著者**: 著者名（CSV互換性のためカンマを全角カンマに置換）
- **フォーマット**: 常に"Kindle"

### 続編結合機能

ツールは続編シリーズを自動検出し結合します：

**対応パターン:**
- **番号巻**: `タイトル(1)`, `タイトル(2)` → `タイトル(1-2)` または非連続の場合 `タイトル(1,3,5)`
- **全角括弧**: `タイトル（１）`, `タイトル（２）` → `タイトル（1-2）`
- **巻フォーマット**: `タイトル9巻`, `タイトル13巻` → `タイトル(9,13)巻`
- **話フォーマット**: `タイトル【第1話】`, `タイトル【第2話】` → `タイトル【第1-2話】`
- **集フォーマット**: `タイトル第一集`, `タイトル第二集` → `タイトル第1-2集`
- **上下**: `タイトル上`, `タイトル下` → `タイトル(上・下)`
- **スペース + 数字**: `タイトル1`, `タイトル 2`, `タイトル　3` → `タイトル(1-3)` スペース区切り数字付きタイトル用
- **末尾数字**: `タイトル1`, `タイトル2`, `タイトル3` → `タイトル(1-3)` 末尾が数字で終わるタイトル用

### エクスポート方法

**オリジナルデータのダウンロード**:
```javascript
downloadCSV()
```

- `kindle_books_YYYY-MM-DD.csv`という名前のファイルを作成
- オリジナル収集データをダウンロード
- デフォルトのダウンロードフォルダに自動ダウンロード

**結合済みデータのダウンロード**:
```javascript
downloadMergedCSV()
```

- `kindle_books_merged_YYYY-MM-DD.csv`という名前のファイルを作成
- 続編シリーズを結合したデータをダウンロード
- 重複エントリを大幅に削減

**クリップボードにコピー**:
```javascript
copyCSV()         // オリジナルデータをコピー
copyMergedCSV()   // 結合済みデータをコピー
```

- CSVデータを直接クリップボードにコピー
- スプレッドシートアプリケーションへの貼り付けに最適

## 🔧 動作原理

スクリプトはDOMセレクターを使用してKindleライブラリページの本エントリを識別します：

- **本のタイトル**: `div[role="heading"][aria-level="4"]`要素から抽出
- **著者**: `div[id^="content-author-"]`要素から抽出
- **ナビゲーション**: `#page-{番号}`のIDパターンを持つページネーションボタンを使用

## 📊 ワークフロー例

1. **初期化**: スクリプト貼り付け時に自動初期化
2. **収集**: 現在のページから本を収集
   ```
   📖 The Great Gatsby by F. Scott Fitzgerald
   📖 To Kill a Mockingbird by Harper Lee
   ✅ Added 25 books from this page. Total: 25
   ```
3. **ナビゲーション**: 次のページに自動移動
   ```
   🔄 Moving from page 1 to page 2...
   ```
4. **完了**: 最終結果を表示
   ```
   🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
   📚 Collection complete! Total books: 347
   💾 Use downloadCSV() or copyCSV() to export data
   🔗 Use mergeSequels() to combine sequel series
   🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
   ```

5. **オプション**: 続編シリーズを結合
   ```
   🔄 Merging sequels from 347 books...
   📚 Merged: プランダラ (21 volumes) -> プランダラ(1-21)
   ✅ Merge complete!
   📊 Original: 347 books
   📊 Merged: 298 entries
   💾 Use downloadMergedCSV() to download merged CSV
   ```

## 🛠️ トラブルシューティング

### よくある問題

**スクリプトが本を見つけられない**:

- 正しいKindleライブラリページにいることを確認
- ライブラリに収集する本があることを確認
- ページを更新してスクリプトを再実行してみる

**ナビゲーションが動作しない**:

- ページネーションコントロールがページに表示されていることを確認
- 本の数が少ないライブラリではページネーションがない場合があります
- `nextPage()`を使用した手動ナビゲーションを試す

**エクスポートが動作しない**:

- ダウンロードに対するブラウザの許可を確認
- クリップボードコピーの場合、ブラウザタブがアクティブでフォーカスされていることを確認

## 📝 データプライバシー

このツールは：

- ✅ 完全にブラウザ内で動作
- ✅ 外部サーバーにデータを送信しません
- ✅ Kindleライブラリページのみにアクセス
- ✅ データはデバイス内に留まります

## 🤝 コントリビューション

バグを発見したり、機能要求がありましたら、issueを開くかプルリクエストを送信してください。

## 📄 ライセンス

このプロジェクトはBeerwareライセンスの下でライセンスされています - 詳細は[LICENSE](LICENSE)ファイルを参照してください。
